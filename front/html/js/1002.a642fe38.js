"use strict";(self["webpackChunks004"]=self["webpackChunks004"]||[]).push([[1002,6485],{328:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"search"},[t("Card",[t("Row",[t("Form",{ref:"searchForm",attrs:{model:e.searchForm,inline:"","label-width":40}},[t("Form-item",{attrs:{label:"姓名",prop:"nickname"}},[t("Input",{staticStyle:{width:"160px"},attrs:{type:"text",clearable:"",placeholder:"搜索姓名"},model:{value:e.searchForm.nickname,callback:function(t){e.$set(e.searchForm,"nickname",t)},expression:"searchForm.nickname"}})],1),t("Form-item",{attrs:{label:"部门",prop:"department"}},[t("department-choose",{ref:"dep",staticStyle:{width:"160px"},attrs:{placeholder:"用户部门"},on:{"on-change":e.handleSelectDep}})],1),t("Form-item",{staticClass:"br",staticStyle:{"margin-left":"10px"}},[t("Button",{attrs:{type:"primary",icon:"ios-search",ghost:"",shape:"circle",size:"small"},on:{click:e.handleSearch}},[e._v("搜索")]),t("Button",{attrs:{type:"warning",ghost:"",shape:"circle",icon:"md-refresh",size:"small"},on:{click:e.handleReset}},[e._v("重置")]),t("Button",{attrs:{type:"info",icon:"md-add",ghost:"",shape:"circle",size:"small"},on:{click:e.add}},[e._v("添加")]),t("Button",{attrs:{type:"success",icon:"md-paper-plane",ghost:"",shape:"circle",size:"small"},on:{click:function(t){e.importModalVisible=!0}}},[e._v("导入")]),t("Button",{attrs:{type:"success",icon:"md-paper-plane",ghost:"",shape:"circle",size:"small"},on:{click:e.excelData}},[e._v("导出")])],1),t("Form-item",{staticStyle:{position:"fixed",right:"50px",top:"130px"}},[t("Button",{staticClass:"showFilterPanelFlag",attrs:{type:"info",icon:"md-settings",size:"small",ghost:""},on:{click:function(t){e.showFilterPanelFlag=!e.showFilterPanelFlag}}},[e._v(" 列筛选")]),t("Button",{staticClass:"showFilterPanelFlag",attrs:{type:"warning",icon:"ios-help-circle-outline",size:"small",ghost:""},on:{click:function(t){e.usingTutorialsModal=!0}}},[e._v(" 使用教程")]),t("Modal",{attrs:{title:"使用教程"},model:{value:e.usingTutorialsModal,callback:function(t){e.usingTutorialsModal=t},expression:"usingTutorialsModal"}},[t("p",[e._v("1.XXXXXXXXXXXXXXXXXXXXXXXX")]),t("p",[e._v("2.XXXXXXXXXXXXXXXXXXXXXXXX")]),t("p",[e._v("3.XXXXXXXXXXXXXXXXXXXXXXXX")])])],1)],1)],1),t("Row",{staticClass:"operation",staticStyle:{position:"relative"}},[t("transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showFilterPanelFlag,expression:"showFilterPanelFlag"}],staticClass:"filter-panel"},[t("CheckboxGroup",{model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.mycolumns,(function(e){return t("div",{key:e.key},[t("Checkbox",{staticStyle:{margin:"2px 5px"},attrs:{label:e.title}})],1)})),0)],1)])],1),t("Row",[t("Table",{ref:"table",attrs:{loading:e.loading,border:"",stripe:"",height:e.height,columns:e.columns,data:e.data,sortable:"custom","row-class-name":e.rowClassName},on:{"on-sort-change":e.changeSort,"on-selection-change":e.showSelect,"on-row-click":e.rowClick}})],1),t("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[t("Page",{attrs:{current:e.searchForm.pageNumber,total:e.total,"page-size":e.searchForm.pageSize,"page-size-opts":[20,30,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1),t("Drawer",{attrs:{title:"导入数据",closable:"",width:"1000"},model:{value:e.importModalVisible,callback:function(t){e.importModalVisible=t},expression:"importModalVisible"}},[t("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("Upload",{attrs:{action:"","before-upload":e.beforeUploadImport,accept:".xls, .xlsx"}},[t("Button",{staticStyle:{"margin-right":"10px"},attrs:{loading:e.reading,icon:"ios-cloud-upload-outline"}},[e._v("上传Excel文件")]),e.uploadfile.name?t("span",[e._v("当前选择文件："+e._s(e.uploadfile.name))]):e._e()],1),t("Button",{attrs:{icon:"md-trash"},on:{click:e.clearImportData}},[e._v("清空数据")])],1),t("Table",{ref:"importTable",attrs:{columns:e.importColumns,border:"",height:e.height,data:e.importTableData}}),t("div",{staticClass:"drawer-footer"},[t("div",{staticStyle:{position:"absolute",right:"15px",display:"inline-block"}},[t("Button",{on:{click:function(t){e.importModalVisible=!1}}},[e._v("关闭")]),t("Button",{staticStyle:{"margin-left":"8px"},attrs:{loading:e.importLoading,disabled:e.importTableData.length<=0,type:"primary"},on:{click:e.importData}},[e._v(" 确认导入 "),e.importTableData.length>0?t("span",[e._v(e._s(e.importTableData.length)+" 条数据")]):e._e()])],1)])],1),t("addEdit",{attrs:{data:e.form,type:e.showType},on:{"on-submit":e.getUserList},model:{value:e.showUser,callback:function(t){e.showUser=t},expression:"showUser"}})],1)},a=[],l=s(5894),o=s(8387),r=s(805),n=s(1990),c=s(8188);const h={name:"user-manage",components:{departmentChoose:o["default"],addEdit:n["default"],dict:c["default"]},data(){return{selected:["编号","用户名","登录账号","头像","所属部门","手机","邮箱","性别","类型","状态","创建时间","操作"],showFilterPanelFlag:!1,usingTutorialsModal:!1,height:510,selectRow:{},showUser:!1,showType:"0",loading:!0,reading:!1,importLoading:!1,loadingExport:!0,exportModalVisible:!1,importModalVisible:!1,drop:!1,selectCount:0,selectList:[],searchForm:{nickname:"",departmentId:"",pageNumber:1,pageSize:20,sort:"createTime",order:"desc",type:0},form:{},columns:[{title:"编号",type:"index",width:80,align:"center",fixed:"left"},{title:"用户名",key:"nickname",minWidth:150,sortable:!0,fixed:"left"},{title:"登录账号",key:"username",minWidth:150,sortable:!0},{title:"头像",key:"avatar",width:80,align:"center",render:(e,t)=>e("Avatar",{props:{src:t.row.avatar}})},{title:"所属部门",key:"departmentTitle",minWidth:120},{title:"手机",key:"mobile",minWidth:155,sortable:!0},{title:"邮箱",key:"email",minWidth:220,sortable:!0},{title:"性别",key:"sex",width:70,align:"center"},{title:"类型",key:"type",align:"center",width:100,render:(e,t)=>1==t.row.type?e("div",[e("span",{style:{color:"#ff9900"}},"教师")]):2==t.row.type?e("div",[e("span",{style:{color:"#ff9900"}},"管理员")]):e("div",["学生"])},{title:"状态",key:"status",align:"center",width:110,render:(e,t)=>0==t.row.status?e("div",[e("span",{style:{color:"#3CB371"}},"正常启用")]):e("div",[e("span",{style:{color:"#ff9900"}},"禁用")])},{title:"创建时间",key:"createTime",sortable:!0,sortType:"desc",width:180},{title:"操作",key:"action",width:300,align:"center",fixed:"right",render:(e,t)=>e("div",[e("Button",{props:{type:"primary",size:"small",ghost:!0,shape:"circle"},style:{marginRight:"5px"},on:{click:()=>{this.edit(t.row)}}},"编辑"),e("Button",{props:{type:"warning",size:"small",ghost:!0,shape:"circle"},style:{marginRight:"5px"},on:{click:()=>{this.resetPass(t.row)}}},"重置密码"),e("Button",{props:{size:"small",ghost:!0,type:0==t.row.status?"error":"success",shape:"circle"},style:{marginRight:"5px"},on:{click:()=>{0==t.row.status?this.disable(t.row):this.enable(t.row)}}},0==t.row.status?"禁用":"启用"),e("Button",{props:{type:"error",size:"small",ghost:!0,shape:"circle"},on:{click:()=>{this.remove(t.row)}}},"删除")])}],filename:"用户数据",importTableData:[],importColumns:[],uploadfile:{name:""},data:[],total:0}},methods:{init(){this.getUserList()},excelData(){this.$refs.table.exportCsv({filename:"导出结果"})},handleSelectDep(e){this.searchForm.departmentId=e},changePage(e){this.searchForm.pageNumber=e,this.getUserList(),this.clearSelectAll()},changePageSize(e){this.searchForm.pageSize=e,this.getUserList()},getUserList(){this.loading=!0,this.searchForm.type=0,(0,l.lE)(this.searchForm).then((e=>{this.loading=!1,e.success&&(this.data=e.result.records,this.total=e.result.total)}))},handleSearch(){this.searchForm.pageNumber=1,this.searchForm.pageSize=20,this.getUserList()},handleReset(){this.$refs.searchForm.resetFields(),this.searchForm.pageNumber=1,this.searchForm.pageSize=10,this.$refs.dep.clearSelect(),this.searchForm.departmentId="",this.getUserList()},changeSort(e){this.searchForm.sort=e.key,this.searchForm.order=e.order,"normal"==e.order&&(this.searchForm.order=""),this.getUserList()},resetPass(e){this.$Modal.confirm({title:"确认重置",content:"重置后密码为123456",loading:!0,onOk:()=>{(0,l.M7)({ids:e.id}).then((e=>{this.$Modal.remove(),e.success&&(this.$Message.success("操作成功"),this.clearSelectAll(),this.getUserList())}))}})},beforeUploadImport(e){this.uploadfile=e;const t=e.name.split(".").pop().toLocaleLowerCase();return"xlsx"==t||"xls"==t?(this.readFile(e),this.file=e):this.$Message.error("不是Excel文件"),!1},readFile(e){this.reading=!0;const t=new FileReader;t.readAsArrayBuffer(e),t.onerror=e=>{this.reading=!1,this.$Message.error("文件读取出错")},t.onload=e=>{const t=e.target.result,{header:s,results:i}=r.ZP.read(t,"array"),a=s.map((e=>({title:e,key:e,minWidth:100,align:"center"})));this.importTableData=i,this.importColumns=a,this.reading=!1,this.$Message.success("读取数据成功")}},clearImportData(){this.importTableData=[],this.importColumns=[],this.uploadfile={}},importData(){this.importLoading=!0,(0,l.Vp)(this.importTableData).then((e=>{this.importLoading=!1,e.success&&(this.importModalVisible=!1,this.getUserList(),this.$Modal.info({title:"导入结果",content:e.message}))}))},add(){this.showType="2",this.showUser=!0},edit(e){for(let i in e)null==e[i]&&(e[i]="");let t=JSON.stringify(e),s=JSON.parse(t);this.form=s,this.showType="1",this.showUser=!0},enable(e){this.$Modal.confirm({title:"确认启用",content:"启用用户 "+e.username+" ?",loading:!0,onOk:()=>{(0,l.Dx)({id:e.id}).then((e=>{this.$Modal.remove(),e.success&&(this.$Message.success("启用成功"),this.getUserList())}))}})},disable(e){this.$Modal.confirm({title:"确认禁用",content:"禁用用户 "+e.username+" ?",loading:!0,onOk:()=>{(0,l.B9)({id:e.id}).then((e=>{this.$Modal.remove(),e.success&&(this.$Message.success("禁用成功"),this.getUserList())}))}})},remove(e){this.$Modal.confirm({title:"确认删除",content:"删除用户 "+e.username+" ?",loading:!0,onOk:()=>{(0,l.h8)({ids:e.id}).then((e=>{this.$Modal.remove(),e.success&&(this.$Message.success("删除成功"),this.getUserList())}))}})},showSelect(e){this.selectList=e,this.selectCount=e.length},clearSelectAll(){this.$refs.table.selectAll(!1)},rowClick(e,t){this.selectRow=e},rowClassName(e,t){return e.id==this.selectRow.id?"rowClassNameColor":""}},mounted(){this.height=window.innerHeight-this.$refs.table.$el.offsetTop-160,this.init(),this.mycolumns=this.columns;let e=[];for(var t=0;t<this.selected.length;t++)for(var s=this.selected[t],i=0;i<this.columns.length;i++)this.columns[i].title==s&&e.push(this.columns[i]);this.columns=e},watch:{selected:function(e){let t=[];for(var s=0;s<this.mycolumns.length;s++){var i=this.mycolumns[s];(void 0==i.title||e.includes(i.title))&&t.push(i)}this.columns=t}}},d=h;var p=s(1001),m=(0,p.Z)(d,i,a,!1,null,null,null);const g=m.exports}}]);